package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {

	cond := sync.NewCond(&sync.Mutex{})

	go func (){
		for range time.Tick(1 * time.Second){ // 1ç§’ãŠãã«å®Ÿè¡Œã™ã‚‹	
			cond.Broadcast()
		}
	}()

	var flag [2]bool

	takeStep := func (){
		cond.L.Lock()
		cond.Wait()
		cond.L.Unlock()
	}

	var wg sync.WaitGroup

	p0 := func(){
		defer wg.Done()
		flag[0] = true
		takeStep()
		for flag[1] {
			takeStep()
			flag[0] = false
			takeStep()
			if flag[0] != flag[1] {
				break
			}
			takeStep()
			flag[0] = true
			takeStep()
			fmt.Println("p0")
		}
	}
	p1 := func(){
		defer wg.Done()
		flag[1] = true
		takeStep()
		for flag[0] {
			takeStep()
			flag[1] = false
			takeStep()
			if flag[0] != flag[1] {
				break
			}
			takeStep()
			flag[1] = true
			takeStep()
			fmt.Println("p1")
		}
	}

	wg.Add(2)

	go p0()
	go p1()

	wg.Wait()
}

// âœ… ãƒ©ã‚¤ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆLivelockï¼‰ã¨ã¯ï¼Ÿ
// ãŠäº’ã„ã«è­²ã‚Šåˆã„ã™ãã¦ã€çµæœçš„ã«ã©ã®å‡¦ç†ã‚‚å‰ã«é€²ã‚ãªããªã‚‹çŠ¶æ…‹
// ï¼ˆæ­¢ã¾ã£ã¦ã‚‹ã‚ã‘ã§ã¯ãªã„ã€ã§ã‚‚é€²ã‚“ã§ãªã„ï¼‰
// ãŠäº’ã„ã«ãƒ–ãƒƒãƒ­ã‚¯ã¯ã•ã‚Œã¦ãªã„

// goroutine ã‚„ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã€Œä»–ã®å‡¦ç†ã®ãŸã‚ã«ä¸€æ™‚åœæ­¢ã—ãŸã‚Šå†è©¦è¡Œã—ãŸã‚Šã€ã‚’ç¹°ã‚Šè¿”ã™
// ã‘ã©ã€ä½•å›è­²ã£ã¦ã‚‚ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒæ‚ªãã¦èª°ã‚‚å‰ã«é€²ã‚ãªã„
// å‹•ã„ã¦ã¯ã„ã‚‹ã‘ã©ã€æœ¬è³ªçš„ã«ã¯â€œæ°¸ä¹…ã«è¶³è¸ã¿ã—ã¦ã‚‹â€çŠ¶æ…‹

// âœ… ä¾‹ãˆã‚‹ãªã‚‰ï¼ˆå®Ÿç”Ÿæ´»ï¼‰
// 2äººãŒç´°ã„é€šè·¯ã§é‰¢åˆã‚ã›
// ãŠäº’ã„è­²ã‚ã†ã¨ã—ã¦ã€å·¦ã«ã‚ˆã‘ã¦â†’ã¶ã¤ã‹ã£ã¦â†’å³ã«ã‚ˆã‘ã¦â†’ã¾ãŸã¶ã¤ã‹ã£ã¦â€¦
// â†’ è­²ã‚Šåˆã£ã¦ã‚‹ã®ã«ä¸€ç”Ÿé€²ã¾ãªã„



// âœ… èªæºï¼šLive + Lock
// 	å˜èª	æ„å‘³
// 	Live	ç”Ÿãã¦ã‚‹ã€å‹•ã„ã¦ã‚‹ï¼ˆâ‰ åœæ­¢ï¼‰
// 	Lock	ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«ã‚ã‚‹ã€é€²ã‚ãªã„

// 	ğŸ”¤ ã¤ã¾ã‚Šï¼š
// â€œå‹•ã„ã¦ã‚‹ï¼ˆliveï¼‰ã®ã«é€²ã¾ãªã„ï¼ˆlockï¼‰â€ã¨ã„ã†ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹ãªçŠ¶æ…‹

// ãƒ©ãƒ–ãƒ­ãƒƒã‚¯ã¯ã‚¨ãƒ©ãƒ¼ã‚’åã‹ãªã„ã®ã§ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯ã‚ˆã‚Šè¦‹ã¤ã‘ã‚‹ã®ãŒé›£ã—ã„ã€‚
